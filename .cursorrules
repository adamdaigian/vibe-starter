# Cursor Rules for Vibe Starter

You are an expert in TypeScript, Next.js App Router, React, Tailwind CSS, and Supabase.

## Project Context

Read these files for context before making changes:
- MASTERPLAN.md - What we're building and why
- IMPLEMENTATION-PLAN.md - Current sprint focus
- AGENTS.md - Detailed coding guidelines

## Code Style

### General
- Use TypeScript for all code
- Prefer functional components with hooks
- Use `const` for functions: `const MyComponent = () => {}`
- Avoid `any` - use proper types or `unknown`
- Use early returns for cleaner logic

### File Naming
- Components: PascalCase (`UserProfile.tsx`)
- Utilities: camelCase (`formatDate.ts`)
- Types: PascalCase with `.types.ts` suffix when separate

### Imports
- Use `@/` alias for src imports
- Group imports: React, Next, third-party, local
- Prefer named exports over default exports

## Next.js Patterns

### Server Components (default)
```tsx
// Good - Server Component
export default async function Page() {
  const data = await fetchData();
  return <div>{data}</div>;
}
```

### Client Components (when needed)
```tsx
// Only when you need interactivity
"use client";

import { useState } from "react";

export default function Counter() {
  const [count, setCount] = useState(0);
  return <button onClick={() => setCount(c => c + 1)}>{count}</button>;
}
```

### When to use "use client"
- useState, useEffect, or other hooks
- Event handlers (onClick, onChange, etc.)
- Browser-only APIs (window, document)
- Third-party client libraries

## Component Patterns

### Use shadcn/ui components
```tsx
import { Button } from "@/components/ui/button";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
```

### Don't modify files in `/components/ui/`
These are shadcn primitives. Create wrapper components if you need customization.

### Loading States
```tsx
import { Loader2 } from "lucide-react";

<Button disabled>
  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
  Loading...
</Button>
```

### Empty States
```tsx
<div className="flex flex-col items-center justify-center py-12 text-center">
  <Icon className="h-12 w-12 text-muted-foreground/50" />
  <h3 className="mt-4 text-lg font-semibold">No items yet</h3>
  <p className="mt-2 text-sm text-muted-foreground">
    Get started by creating your first item.
  </p>
  <Button className="mt-4">Create Item</Button>
</div>
```

## Styling

### Use Tailwind classes
```tsx
// Good
<div className="flex items-center gap-4 rounded-lg border p-4">

// Avoid inline styles
<div style={{ display: 'flex' }}>
```

### Color tokens
- `bg-background` / `text-foreground` - Primary colors
- `bg-muted` / `text-muted-foreground` - Secondary
- `bg-card` - Card backgrounds
- `border-border` - Borders
- `text-destructive` - Errors

### Responsive design
```tsx
<div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
```

## Supabase

### Server-side queries
```tsx
import { createClient } from "@/lib/supabase/server";

export default async function Page() {
  const supabase = await createClient();
  const { data, error } = await supabase.from("items").select();
}
```

### Client-side queries
```tsx
"use client";
import { createClient } from "@/lib/supabase/client";

const supabase = createClient();
const { data } = await supabase.from("items").select();
```

### Auth check pattern
```tsx
const { data: { user } } = await supabase.auth.getUser();
if (!user) redirect("/login");
```

## Form Handling

### Use react-hook-form + zod
```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

const schema = z.object({
  email: z.string().email(),
  name: z.string().min(2),
});

type FormData = z.infer<typeof schema>;

const form = useForm<FormData>({
  resolver: zodResolver(schema),
});
```

## Error Handling

### API Routes
```tsx
export async function POST(request: Request) {
  try {
    // ... logic
    return Response.json({ data });
  } catch (error) {
    console.error("Error:", error);
    return Response.json({ error: "Something went wrong" }, { status: 500 });
  }
}
```

### Components
```tsx
{error && (
  <div className="rounded-md border border-destructive/50 bg-destructive/10 p-3 text-sm text-destructive">
    {error.message}
  </div>
)}
```

## Performance

- Use `loading.tsx` for route loading states
- Use `error.tsx` for route error boundaries
- Prefer Server Components for data fetching
- Use `next/image` for images
- Use `next/link` for navigation

## Don't

- ❌ Use `any` type
- ❌ Modify shadcn/ui component files
- ❌ Leave console.log in production code
- ❌ Skip error handling
- ❌ Use inline styles
- ❌ Create components without types

## Do

- ✅ Add types to all functions
- ✅ Handle loading and error states
- ✅ Use semantic HTML elements
- ✅ Follow the existing code patterns
- ✅ Update IMPLEMENTATION-PLAN.md when completing tasks
